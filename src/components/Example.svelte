<script lang="ts">
  import MultiSelect, { Option, Primitive } from '../lib'
  import Confetti from './Confetti.svelte'
  import { mlFrameworks, webFrameworks } from './frameworks'

  let selectedWeb: Primitive[]
  let activeWeb: Option
  let selectedML: Option[]

  // used to show user hint to try arrow keys but only once
  let neverActive = true
  let showConfetti = false
  $: if (activeWeb) neverActive = false

  const placeholder = `Take your pick...`
  const filterFunc = (op: Option, searchText: string) => {
    if (!searchText) return true
    const [label, lang, searchStr] = [op.label, op.lang, searchText].map((s) =>
      `${s}`.toLowerCase()
    )
    return label.includes(searchStr) || lang.includes(searchStr)
  }
</script>

<section>
  <h3>Multi Select</h3>

  <label for="fav-web-tool">Favorite Web Frameworks?</label>

  <pre><code>selectedLabels = {JSON.stringify(selectedWeb)}</code></pre>

  <MultiSelect
    id="fav-web-tool"
    options={webFrameworks}
    bind:selectedLabels={selectedWeb}
    bind:activeOption={activeWeb}
    maxSelect={6}
    {placeholder}
    {filterFunc}
  />
</section>

<section>
  <h3>Single Select</h3>

  <label for="fav-ml-tool">Favorite Machine Learning Framework?</label>

  <pre><code>selected = {JSON.stringify(selectedML)}</code></pre>

  <MultiSelect
    id="fav-ml-tool"
    maxSelect={1}
    maxSelectMsg={(current, max) => `${current} of ${max} selected`}
    options={mlFrameworks}
    bind:selected={selectedML}
    {placeholder}
  />
</section>

<section>
  <h3>50/50 Chance of Confetti</h3>

  <label for="confetti-select">Favorite Web Frameworks?</label>

  <MultiSelect
    id="confetti-select"
    options={[`React`, `Svelte`]}
    maxSelect={1}
    {placeholder}
    on:add={(e) => {
      if (e.detail.option.label === `Svelte`) {
        showConfetti = true
        setTimeout(() => (showConfetti = false), 4000)
      }
    }}
  />
  {#if showConfetti}
    <Confetti />
  {/if}
</section>

<section>
  <h3>Slot Components</h3>

  <label for="fruit-select">Custom renderers for options and/or selected items</label>

  <MultiSelect
    id="fruit-select"
    options={[`Banana`, `Watermelon`, `Apple`, `Dates`, `Mango`]}
    {placeholder}
  >
    <span let:idx let:option slot="renderOptions">
      {idx + 1}. {option.label}
      {option.label === `Mango` ? `ðŸŽ‰` : ``}
    </span>
    <span let:idx let:option slot="renderSelected">
      #{idx + 1}
      {option.label}
    </span>
  </MultiSelect>
</section>

<style>
  :root {
    --sms-active-color: var(--blue);
    --sms-options-bg: black;
  }
  section {
    margin-top: 2em;
    background-color: #28154b;
    border-radius: 1ex;
    padding: 1pt 1.4ex;
  }
  pre {
    white-space: pre-wrap;
  }
</style>
